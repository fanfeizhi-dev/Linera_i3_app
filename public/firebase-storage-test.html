<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Storage æµ‹è¯• - Model Data</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .upload-section {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            border-radius: 8px;
        }
        .upload-section.dragover {
            border-color: #007bff;
            background: #f0f8ff;
        }
        .data-preview {
            max-height: 400px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .model-item {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            background: white;
        }
        .model-name {
            font-weight: bold;
            color: #007bff;
        }
        .model-details {
            font-size: 0.9em;
            color: #666;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¥ Firebase Storage æµ‹è¯• - Model Data</h1>
        
        <div class="status info">
            <strong>åŠŸèƒ½è¯´æ˜ï¼š</strong> æµ‹è¯•ä» Firebase Storage è¯»å– model-data.js æ–‡ä»¶ï¼Œå¹¶å±•ç¤ºæ•°æ®
        </div>

        <div class="status info">
            <strong>å½“å‰çŠ¶æ€ï¼š</strong>
            <div id="storageStatus">æ­£åœ¨æ£€æŸ¥...</div>
            <div id="dataStatus">ç­‰å¾…æ•°æ®...</div>
        </div>

        <!-- ä¸Šä¼ åŒºåŸŸ -->
        <div class="upload-section" id="uploadSection">
            <h3>ğŸ“ ä¸Šä¼  Model Data åˆ° Storage</h3>
            <p>æ‹–æ‹½ model-data.js æ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
            <input type="file" id="fileInput" accept=".js" style="display: none;">
            <button onclick="document.getElementById('fileInput').click()">é€‰æ‹©æ–‡ä»¶</button>
            <button onclick="uploadToStorage()" id="uploadBtn" disabled>ä¸Šä¼ åˆ° Storage</button>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div>
            <button onclick="downloadFromStorage()">ğŸ“¥ ä» Storage ä¸‹è½½</button>
            <button onclick="clearData()">ğŸ—‘ï¸ æ¸…é™¤æ•°æ®</button>
            <button onclick="showStats()">ğŸ“Š æ˜¾ç¤ºç»Ÿè®¡</button>
        </div>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="stats" id="statsSection" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="totalModels">-</div>
                <div class="stat-label">æ€»æ¨¡å‹æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgRating">-</div>
                <div class="stat-label">å¹³å‡è¯„åˆ†</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalUsage">-</div>
                <div class="stat-label">æ€»ä½¿ç”¨é‡</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="categories">-</div>
                <div class="stat-label">åˆ†ç±»æ•°é‡</div>
            </div>
        </div>

        <!-- æ•°æ®é¢„è§ˆ -->
        <h3>ğŸ“‹ Model Data é¢„è§ˆ</h3>
        <div class="data-preview" id="dataPreview">
            <p>æ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
        </div>
    </div>

    <!-- å¼•å…¥Firebase SDK -->
    <script type="module">
        // å¯¼å…¥Firebase SDK
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getStorage, ref, uploadBytes, getDownloadURL, listAll } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
        
        // Firebaseé…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyCYdWqXjUfNbUAMW1cm8neZQGTBTA63pfM",
            authDomain: "i3-testnet.firebaseapp.com",
            projectId: "i3-testnet",
            storageBucket: "i3-testnet.firebasestorage.app",
            messagingSenderId: "892139814159",
            appId: "1:892139814159:web:4df8548eef1d9bd9a1927a",
            measurementId: "G-KCDG3D1FCC"
        };

        // åˆå§‹åŒ–Firebase
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);
        
        let selectedFile = null;
        let modelData = null;

        // é¡µé¢åŠ è½½å®Œæˆåæ›´æ–°çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('storageStatus', 'âœ… Storage æœåŠ¡å·²è¿æ¥', 'success');
            updateStatus('dataStatus', 'ç­‰å¾…ä¸Šä¼ æˆ–ä¸‹è½½æ•°æ®...', 'info');
        });

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        document.getElementById('fileInput').addEventListener('change', function(e) {
            selectedFile = e.target.files[0];
            if (selectedFile) {
                document.getElementById('uploadBtn').disabled = false;
                updateStatus('dataStatus', `å·²é€‰æ‹©æ–‡ä»¶: ${selectedFile.name} (${(selectedFile.size / 1024).toFixed(2)} KB)`, 'info');
            }
        });

        // æ‹–æ‹½ä¸Šä¼ 
        const uploadSection = document.getElementById('uploadSection');
        uploadSection.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        });
        uploadSection.addEventListener('dragleave', function() {
            uploadSection.classList.remove('dragover');
        });
        uploadSection.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            selectedFile = e.dataTransfer.files[0];
            if (selectedFile && selectedFile.name.endsWith('.js')) {
                document.getElementById('fileInput').files = e.dataTransfer.files;
                document.getElementById('uploadBtn').disabled = false;
                updateStatus('dataStatus', `å·²é€‰æ‹©æ–‡ä»¶: ${selectedFile.name} (${(selectedFile.size / 1024).toFixed(2)} KB)`, 'info');
            }
        });

        // ä¸Šä¼ åˆ°Storage
        window.uploadToStorage = async function() {
            if (!selectedFile) {
                alert('è¯·å…ˆé€‰æ‹©æ–‡ä»¶');
                return;
            }

            try {
                updateStatus('dataStatus', 'æ­£åœ¨ä¸Šä¼ åˆ° Storage...', 'info');
                
                const storageRef = ref(storage, 'model-data.js');
                const snapshot = await uploadBytes(storageRef, selectedFile);
                const downloadURL = await getDownloadURL(snapshot.ref);
                
                updateStatus('dataStatus', 'âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼', 'success');
                console.log('æ–‡ä»¶ä¸Šä¼ æˆåŠŸ:', downloadURL);
                
                // è‡ªåŠ¨ä¸‹è½½å¹¶è§£æ
                setTimeout(() => {
                    downloadFromStorage();
                }, 1000);
                
            } catch (error) {
                updateStatus('dataStatus', `âŒ ä¸Šä¼ å¤±è´¥: ${error.message}`, 'error');
                console.error('ä¸Šä¼ é”™è¯¯:', error);
            }
        };

        // ä»Storageä¸‹è½½
        window.downloadFromStorage = async function() {
            try {
                updateStatus('dataStatus', 'æ­£åœ¨ä» Storage ä¸‹è½½...', 'info');
                
                const storageRef = ref(storage, 'model-data.js');
                const downloadURL = await getDownloadURL(storageRef);
                
                // ä¸‹è½½æ–‡ä»¶å†…å®¹
                const response = await fetch(downloadURL);
                const fileContent = await response.text();
                
                // è§£æJavaScriptå†…å®¹ï¼ˆæå–MODEL_DATAå¯¹è±¡ï¼‰
                try {
                    // ç®€å•çš„æ­£åˆ™è¡¨è¾¾å¼æå–ï¼Œå®é™…é¡¹ç›®ä¸­å¯èƒ½éœ€è¦æ›´å¤æ‚çš„è§£æ
                    const modelDataMatch = fileContent.match(/const MODEL_DATA = ({[\s\S]*});/);
                    if (modelDataMatch) {
                        // æ³¨æ„ï¼šè¿™ç§è§£ææ–¹å¼åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸å¤Ÿå®‰å…¨ï¼Œä»…ç”¨äºæ¼”ç¤º
                        const modelDataStr = modelDataMatch[1];
                        // ä½¿ç”¨ Function æ„é€ å™¨æ¥è§£æï¼ˆä»…ç”¨äºæ¼”ç¤ºï¼‰
                        const parseFunction = new Function(`return ${modelDataStr}`);
                        modelData = parseFunction();
                        
                        updateStatus('dataStatus', 'âœ… æ•°æ®ä¸‹è½½å¹¶è§£ææˆåŠŸï¼', 'success');
                        displayModelData();
                    } else {
                        throw new Error('æ— æ³•æ‰¾åˆ° MODEL_DATA å¯¹è±¡');
                    }
                } catch (parseError) {
                    updateStatus('dataStatus', `âŒ æ•°æ®è§£æå¤±è´¥: ${parseError.message}`, 'error');
                    console.error('è§£æé”™è¯¯:', parseError);
                }
                
            } catch (error) {
                updateStatus('dataStatus', `âŒ ä¸‹è½½å¤±è´¥: ${error.message}`, 'error');
                console.error('ä¸‹è½½é”™è¯¯:', error);
            }
        };

        // æ˜¾ç¤ºæ¨¡å‹æ•°æ®
        function displayModelData() {
            if (!modelData) return;
            
            const preview = document.getElementById('dataPreview');
            const models = Object.entries(modelData).slice(0, 10); // åªæ˜¾ç¤ºå‰10ä¸ª
            
            let html = '<h4>å‰10ä¸ªæ¨¡å‹æ•°æ®ï¼š</h4>';
            models.forEach(([name, data]) => {
                html += `
                    <div class="model-item">
                        <div class="model-name">${name}</div>
                        <div class="model-details">
                            <strong>ç”¨é€”:</strong> ${data.purpose.substring(0, 100)}...<br>
                            <strong>åˆ†ç±»:</strong> ${data.category} | 
                            <strong>è¡Œä¸š:</strong> ${data.industry} | 
                            <strong>è¯„åˆ†:</strong> ${data.rating} | 
                            <strong>ä»·æ ¼:</strong> ${data.tokenPrice} tokens
                        </div>
                    </div>
                `;
            });
            
            html += `<p><em>æ˜¾ç¤º ${models.length} ä¸ªæ¨¡å‹ï¼Œæ€»å…± ${Object.keys(modelData).length} ä¸ª</em></p>`;
            preview.innerHTML = html;
        }

        // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
        window.showStats = function() {
            if (!modelData) {
                alert('è¯·å…ˆä¸‹è½½æ•°æ®');
                return;
            }
            
            const statsSection = document.getElementById('statsSection');
            statsSection.style.display = 'grid';
            
            const models = Object.values(modelData);
            const totalModels = models.length;
            const avgRating = (models.reduce((sum, m) => sum + m.rating, 0) / totalModels).toFixed(2);
            const totalUsage = models.reduce((sum, m) => sum + m.usage, 0);
            const categories = new Set(models.map(m => m.category)).size;
            
            document.getElementById('totalModels').textContent = totalModels;
            document.getElementById('avgRating').textContent = avgRating;
            document.getElementById('totalUsage').textContent = totalUsage.toLocaleString();
            document.getElementById('categories').textContent = categories;
        };

        // æ¸…é™¤æ•°æ®
        window.clearData = function() {
            modelData = null;
            document.getElementById('dataPreview').innerHTML = '<p>æ•°æ®å·²æ¸…é™¤...</p>';
            document.getElementById('statsSection').style.display = 'none';
            updateStatus('dataStatus', 'æ•°æ®å·²æ¸…é™¤', 'info');
        };

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = type;
        }
    </script>
    <script src="pricing.js"></script>
    <script src="model-data.js"></script>
</body>
</html> 